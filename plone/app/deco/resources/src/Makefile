GIT = git
NPM = npm
TESTEM = ./node_modules/.bin/testem

DECO = build/deco.js

all:: deco

clean: clean_deco

bootstrap:
	mkdir -p build
	$(NPM) install testem --prefix=./node_modules


test:
	$(TESTEM)

test-ci:
	$(TESTEM) ci


clean_deco:
	rm -rf $(DECO)

deco: clean_deco $(DECO)
	# ---------------------------------------------------------------------------- #
	# cp build/deco.js path/to/plone.app.deco/plone/app/deco/resources/src/deco.js #
	# ---------------------------------------------------------------------------- #

build/deco.js:
# requirejs/almond should already be included by plone.app.toolbar
	echo "/* this file was autogenerated. see plone.app.deco/docs/SETUP.txt for details. */" > $@
	cat "js/deco.js" >> $@
	cat "js/deco.dragdrop.js" >> $@
	cat "js/deco.tile.js" >> $@
	cat "js/deco.column.js" >> $@
	cat "js/deco.row.js" >> $@
	cat "js/deco.panel.js" >> $@
	cat "js/deco.toolbar.js" >> $@
	cat "js/deco.init.js" >> $@
	echo "require(['deco.init']);" >> $@



.PHONY: all clean bootstrap test test-ci deco
